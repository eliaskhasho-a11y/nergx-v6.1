
const State={notis:[]};
function addNotif(txt,type='info'){State.notis.unshift({txt,type,t:new Date().toLocaleTimeString()});renderNotifs()}
function renderNotifs(){const n=document.getElementById('notifList');if(!n)return;if(!State.notis.length){n.innerHTML='–';return}n.innerHTML=State.notis.slice(0,8).map(x=>`<div class="row"><span class="chip">${x.type}</span><span class="small">${x.t}</span></div><div>${x.txt}</div>`).join('<hr/>')}
function initCoach(){const log=document.getElementById('coachLog'),input=document.getElementById('coachInput'),send=document.getElementById('coachSend');function push(s,m){const d=document.createElement('div');d.innerHTML=`<span class="chip">${s}</span> <span class="small">${new Date().toLocaleTimeString()}</span><br>${m}`;d.style.marginBottom='8px';log.appendChild(d);log.scrollTop=log.scrollHeight}function reply(q){if(/lager|brist/i.test(q))return 'Lagerbrist på CAR-CHG-60W (4 kvar). Föreslår inköp 100 st.';if(/budget|oms/i.test(q))return 'Omsättning denna vecka ~2.1 Mkr. Prognos ~+8% mot föregående.';return 'Jag analyserar — förslag: fokus region Syd (hög konvertering).'}function sendNow(){const v=input.value.trim();if(!v)return;push('Du',v);input.value='';setTimeout(()=>push('AI',reply(v)),250)}send.onclick=sendNow;input.addEventListener('keydown',e=>{if(e.key==='Enter'){e.preventDefault();sendNow()}})}
function themeInit(){const sel=document.getElementById('themeSel');const saved=localStorage.getItem('theme')||'dark';sel.value=saved;if(saved==='light'){document.documentElement.style.setProperty('--bg','#f7f8fb');document.documentElement.style.setProperty('--panel','#ffffff');document.documentElement.style.setProperty('--card','#ffffff');document.documentElement.style.setProperty('--text','#0b0e14');document.documentElement.style.setProperty('--border','rgba(0,0,0,.08)')}sel.onchange=()=>{localStorage.setItem('theme',sel.value);location.reload()}}
addEventListener('DOMContentLoaded',()=>{themeInit();Router.init();initCoach();addNotif('AI aktiv, varnar vid risker','info');addNotif('1 sen packning för upphämtning 16:00. Föreslår snabbprioritet.','warn')});
