<!DOCTYPE html>
<html lang="sv">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>MergX v8.16 ‚Ä¢ Light + Glass</title>

<!-- Icons / fonts -->
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root{
  --bg: #f6f8fb;
  --panel: rgba(255,255,255,.65);
  --stroke: rgba(20,24,40,.08);
  --text: #0c1222;
  --muted: #6b7280;
  --accent: #3aaed8;        /* Pastell bl√•/turkos */
  --accent-2: #7cd1c0;       /* Pastell gr√∂n */
  --accent-3: #d2e0ff;       /* ljusbl√• ytor */
  --danger: #e74c3c;
  --warn: #f59e0b;
  --good: #22c55e;
  --bubble-blue:#2c7be5;
  --bubble-cyan:#35c3c3;
  --corner: 16px;
  --shadow: 0 10px 30px rgba(15, 23, 42, .10);
  --glass-blur: blur(16px);
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;background:var(--bg);
  font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  color:var(--text);
}

/* Layout */
.app{display:grid; grid-template-columns: 250px 1fr; gap:20px; padding:20px;}
.aside{
  position:sticky; top:20px; height:calc(100vh - 40px);
  background:var(--panel); backdrop-filter:var(--glass-blur);
  border:1px solid var(--stroke); border-radius:var(--corner);
  box-shadow:var(--shadow); padding:14px 12px; display:flex; flex-direction:column;
}
.brand{
  display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:12px
}
.brand .logo{
  width:28px;height:28px;border-radius:8px;
  background: linear-gradient(135deg, #53c8e0, #7ad3c2);
}
.brand strong{letter-spacing:.3px}
.nav{margin-top:10px; display:flex; flex-direction:column; gap:6px}
.nav a{
  text-decoration:none; color:var(--text); font-weight:500;
  padding:10px 12px; border-radius:10px; border:1px solid transparent;
}
.nav a:hover{background:rgba(122, 211, 194, .15); border-color:var(--stroke)}
.nav a.active{background:white; border-color:var(--stroke); box-shadow:0 6px 14px rgba(15,23,42,.06)}

.main{display:flex; flex-direction:column; gap:20px}

/* Topbar */
.topbar{
  position:sticky; top:0; z-index: 2000;  /* <- h√•ller allt √∂ver droplager */
  background: linear-gradient(180deg, rgba(246,248,251,.85), rgba(246,248,251,.55));
  backdrop-filter: blur(10px);
  border:1px solid var(--stroke);
  border-radius: var(--corner);
  padding:10px; display:flex; gap:10px; align-items:center; box-shadow:var(--shadow);
}
.search{
  position:relative; flex:1;
}
.search input{
  width:100%; padding:12px 14px 12px 38px; border-radius:12px; border:1px solid var(--stroke);
  background:white; outline:none; font-size:14px;
}
.search .i{position:absolute; left:12px; top:50%; translate:0 -50%; opacity:.55}
.kpis{display:grid; grid-template-columns: repeat(4, minmax(160px,1fr)); gap:10px; width:100%}
.kpi{
  position:relative;
  background:var(--panel); border:1px solid var(--stroke); backdrop-filter:var(--glass-blur);
  border-radius:14px; padding:12px; box-shadow: var(--shadow);
}
.kpi small{color:var(--muted); display:block}
.kpi b{font-size:22px}
.kpi .trend{font-weight:600}
.kpi .detail{
  position:absolute; left:0; right:0; top:calc(100% + 6px);
  background:white; border:1px solid var(--stroke); border-radius:12px; box-shadow:var(--shadow);
  padding:12px; display:none; z-index: 3000;   /* <- √∂ver s√∂kf√§ltet */
}
.kpi:hover .detail{display:block}

/* Panels / cards */
.panel{
  background:var(--panel); border:1px solid var(--stroke); border-radius:var(--corner);
  box-shadow:var(--shadow); backdrop-filter:var(--glass-blur); padding:14px;
}
.panel h3{margin:0 0 10px;font-size:16px}
.grid-2{display:grid; grid-template-columns: 1.3fr .7fr; gap:16px}
.grid-3{display:grid; grid-template-columns: 1fr 1fr 1fr; gap:16px}

/* Chart */
#ecoChart{max-height:340px}

/* AI Map */
#map{height:260px; border-radius:12px; border:1px solid var(--stroke)}

/* Tables / lists */
.table{
  width:100%; border-collapse: collapse; font-size:14px; border-radius:12px; overflow:hidden;
  background:white; border:1px solid var(--stroke)
}
.table th,.table td{padding:10px 12px; border-bottom:1px solid var(--stroke); text-align:left}
.table th{background:#f7f9ff; color:#445}
.table tr:hover{background:#f9fbff}
.badge{display:inline-block; padding:2px 8px; border-radius:20px; font-size:12px; background:#eef4ff}

/* Row actions */
.row-actions{display:flex; gap:6px}
.btn{
  appearance:none; border:1px solid var(--stroke); background:white; color:#223; padding:6px 10px;
  border-radius:8px; cursor:pointer; font-weight:600
}
.btn:disabled{opacity:.5; cursor:not-allowed}
.btn.primary{background:linear-gradient(135deg, var(--accent), var(--accent-2)); color:white; border-color:transparent}
.btn.warn{background: #fff4e5; color:#7a4d00; border-color:#f2dec0}
.btn.danger{background:#ffecec; color:#7a1c17; border-color:#f3c1bc}

/* Chat (iOS-stil) */
.chat-wrap{display:flex; flex-direction:column; gap:8px; min-height:220px}
.bubble{
  max-width:68%; padding:10px 12px; border-radius:16px; color:#fff; font-weight:500
}
.bubble.me{ margin-left:auto; background: linear-gradient(135deg, var(--bubble-cyan), var(--bubble-blue))}
.bubble.you{background: #e5e7eb; color:#111}
.chat-input{
  display:flex; gap:8px; align-items:center; padding:8px; border:1px solid var(--stroke);
  border-radius:999px; background:white
}
.chat-input input{flex:1; border:0; outline:none; height:36px}
.attach{display:flex; gap:6px}
.attach button{width:34px; height:34px; border-radius:999px; border:1px solid var(--stroke); background:#f7f9ff}

/* Notifications bell */
.bell{
  position:relative; width:36px; height:36px; border-radius:999px; border:1px solid var(--stroke); background:white
}
.bell .dot{
  position:absolute; right:-2px; top:-2px; background:#ef4444; color:#fff; font-size:11px;
  width:18px; height:18px; border-radius:999px; display:grid; place-content:center; font-weight:700
}

/* Preview modal */
.modal{
  position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:4000;
  background:rgba(2,6,21,.45); padding:20px
}
.modal .sheet{
  max-width:960px; width:100%; background:white; border-radius:14px; border:1px solid var(--stroke);
  padding:16px; box-shadow:var(--shadow)
}
.modal header{display:flex; justify-content:space-between; align-items:center; margin-bottom:12px}
.modal .close{border:0; background:#f3f4f6; border-radius:8px; padding:6px 10px; cursor:pointer}
.show{display:flex}

/* Router */
.page{display:none}
.page.active{display:block}

/* Responsive */
@media (max-width: 1100px){
  .kpis{grid-template-columns: repeat(2, 1fr)}
  .grid-2{grid-template-columns:1fr}
}
@media (max-width: 900px){
  .app{grid-template-columns: 1fr}
  .aside{position:relative; height:auto}
  .kpis{grid-template-columns:1fr}
}
</style>
</head>
<body>

<div class="app">
  <!-- SIDEBAR -->
  <aside class="aside">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <strong>MergX</strong><br/>
        <small>Base v8.16 ‚Ä¢ Online</small>
      </div>
    </div>

    <nav class="nav" id="nav">
      <a href="#/dashboard" class="active">√ñversikt</a>
      <a href="#/customers">Kunder</a>
      <a href="#/inventory">Inventarie</a>
      <a href="#/orders">Order & Faktura</a>
      <a href="#/employees">Anst√§llda</a>
      <a href="#/files">Filer & Kvitton</a>
      <a href="#/chat">Chatt</a>
      <a href="#/settings">Inst√§llningar</a>
    </nav>

    <div style="margin-top:auto; display:flex; align-items:center; gap:10px; padding:8px 6px;">
      <button class="bell" id="bell"><span class="dot" id="dot">3</span></button>
      <small style="color:var(--muted)">Notiser</small>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">

    <!-- TOPBAR -->
    <div class="topbar">
      <div class="search">
        <svg class="i" width="18" height="18" viewBox="0 0 24 24" fill="none">
          <path d="M21 21l-4.3-4.3M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="#475569" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <input id="q" placeholder="Global s√∂k (‚åò/Ctrl + K) ‚Äî kunder, produkter, ordrar ‚Ä¶" />
      </div>
      <div class="kpis">
        <div class="kpi">
          <small>Oms√§ttning (idag)</small>
          <b id="kpiSales">124 500 kr</b>
          <div class="trend" style="color:var(--good)">+6.2%</div>

          <!-- DETAIL POPOVER (z-index √∂ver topbar) -->
          <div class="detail">
            <strong>Oms√§ttning ‚Äî detalj</strong>
            <ul style="margin:6px 0 0 18px; padding:0">
              <li>Idag: 42 850 kr <span style="color:var(--good)">(+12%)</span></li>
              <li>7 dagar: 312 400 kr</li>
              <li>30 dagar: 1 224 900 kr</li>
            </ul>
          </div>
        </div>

        <div class="kpi"><small>Order idag</small><b>37</b><div class="trend" style="color:var(--good)">+4</div></div>
        <div class="kpi"><small>Kostnader (idag)</small><b>48 900 kr</b><div class="trend" style="color:#ef4444">‚àí2.1%</div></div>
        <div class="kpi"><small>Bruttomarginal</small><b>41.5%</b><div class="trend" style="color:var(--good)">+0.7 pp</div></div>
      </div>
    </div>

    <!-- PAGES -->
    <section class="page active" id="page-dashboard">
      <div class="grid-2">
        <div class="panel">
          <h3>Ekonomi ‚Äî kombostaplar</h3>
          <canvas id="ecoChart"></canvas>
        </div>

        <div class="panel">
          <h3>AI-karta (mini)</h3>
          <div id="map"></div>
          <div style="margin-top:8px; text-align:center">
            <button class="btn" onclick="alert('AI-rekommendationer (mock)');">AI-rekommendationer</button>
          </div>
        </div>
      </div>

      <div class="grid-3">
        <div class="panel">
          <h3>Teamchatt</h3>
          <div class="chat-wrap" id="chatBox">
            <div class="bubble you">God morgon teamet!</div>
            <div class="bubble me">Jag tar kundm√∂tet 11:00.</div>
          </div>
          <div style="margin-top:10px; display:flex; gap:8px; align-items:center">
            <div class="attach">
              <button title="Ladda upp fil" onclick="alert('Filuppladdning (mock)')">üìé</button>
              <button title="Spela in ljud" onclick="alert('R√∂stinspelning (mock)')">üé§</button>
            </div>
            <div class="chat-input" style="flex:1">
              <input id="chatInput" placeholder="Skriv ett meddelande‚Ä¶ (Enter f√∂r att skicka)" />
              <button class="btn primary" onclick="sendChat()">Skicka</button>
            </div>
          </div>
        </div>

        <div class="panel">
          <h3>Ordrar & fakturor</h3>
          <table class="table" id="ordersTable">
            <thead><tr><th>Nr</th><th>Kund</th><th>Total</th><th>Status</th><th style="width:140px">√Ötg√§rder</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="panel">
          <h3>Notiser</h3>
          <div id="notices">
            <div>üîî Ny order #M-10306</div>
            <div>üßæ PDF-faktura mock genererad</div>
          </div>
        </div>
      </div>
    </section>

    <!-- CUSTOMERS -->
    <section class="page" id="page-customers">
      <div class="panel">
        <h3>Kunder</h3>
        <table class="table" id="customersTable">
          <thead><tr>
            <th>ID</th><th>F√∂retag</th><th>Kontakt</th><th>Email</th><th>Telefon</th><th>Stad</th><th style="width:160px">√Ötg√§rder</th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <div class="panel" id="customerDrawer" style="display:none">
        <h3>Kund ‚Ä¢ detalj</h3>
        <div id="customerDetail" style="color:var(--muted)">V√§lj en kund i listan.</div>
      </div>
    </section>

    <!-- INVENTORY -->
    <section class="page" id="page-inventory">
      <div class="panel">
        <h3>Produkter</h3>
        <table class="table" id="inventoryTable">
          <thead><tr>
            <th>SKU</th><th>Namn</th><th>Pris</th><th>Lagersaldo</th><th style="width:160px">√Ötg√§rder</th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- ORDERS -->
    <section class="page" id="page-orders">
      <div class="panel">
        <h3>Order & Faktura</h3>
        <table class="table" id="ordersTable2">
          <thead><tr><th>Ordernr</th><th>Kund</th><th>Status</th><th>Betalvillkor</th><th>Total</th><th style="width:160px">√Ötg√§rder</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- EMPLOYEES -->
    <section class="page" id="page-employees">
      <div class="panel">
        <h3>Anst√§llda</h3>
        <table class="table" id="employeesTable">
          <thead><tr>
            <th>ID</th><th>Namn</th><th>Roll</th><th>Email</th><th>Telefon</th><th>Form</th><th style="width:140px">√Ötg√§rder</th>
          </tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </section>

    <!-- FILES -->
    <section class="page" id="page-files">
      <div class="panel">
        <h3>Filer & kvitton</h3>
        <p class="badge">Kommande: mappar, taggar, arbetsfl√∂den & export till Ekonomi/Admin</p>
        <div style="margin-top:8px"><button class="btn" onclick="alert('Uppladdning (mock)')">Ladda upp</button></div>
      </div>
    </section>

    <!-- CHAT -->
    <section class="page" id="page-chat">
      <div class="panel">
        <h3>Teamchatt</h3>
        <div class="chat-wrap" id="chatBox2"></div>
        <div style="margin-top:10px; display:flex; gap:8px; align-items:center">
          <div class="attach">
            <button title="Ladda upp fil" onclick="alert('Filuppladdning (mock)')">üìé</button>
            <button title="Spela in ljud" onclick="alert('R√∂stinspelning (mock)')">üé§</button>
          </div>
          <div class="chat-input" style="flex:1">
            <input id="chatInput2" placeholder="Skriv ett meddelande‚Ä¶ (Enter f√∂r att skicka)" />
            <button class="btn primary" onclick="sendChat(2)">Skicka</button>
          </div>
        </div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section class="page" id="page-settings">
      <div class="panel">
        <h3>Inst√§llningar</h3>
        <p>Plats f√∂r tema, spr√•k, integrationer (Fortnox/Visma/Slack/Deepseek/Ollama), beh√∂righeter (RBAC), m.m.</p>
      </div>
    </section>

  </main>
</div>

<!-- ORDER PREVIEW MODAL -->
<div class="modal" id="preview">
  <div class="sheet">
    <header>
      <strong>F√∂rhandsgranskning ‚Ä¢ Faktura</strong>
      <div style="display:flex; gap:8px">
        <button class="btn" onclick="downloadPdf()">Ladda ner PDF</button>
        <button class="close" onclick="toggle('#preview', false)">St√§ng</button>
      </div>
    </header>
    <iframe id="pdfFrame" style="border:0; width:100%; height:70vh; background:#fff"></iframe>
  </div>
</div>

<script>
/* ---------- Simple data (mock) ---------- */
const customers = [
  {id:"C1001", company:"Nordic AB", contact:"Eva Berg", email:"eva@nordic.se", phone:"+46 70 123 45 67", city:"Stockholm"},
  {id:"C1002", company:"Stock Wireless", contact:"Jonas Ek", email:"sales@stockwireless.se", phone:"+46 73 555 66 77", city:"Stockholm"},
  {id:"C1003", company:"Elon Ljud & Bild", contact:"Butikschef", email:"info@elonlb.se", phone:"+46 8 111 22 33", city:"V√§ster√•s"},
  {id:"C1004", company:"Tammerbrands", contact:"Ink√∂p", email:"buy@tammerbrands.fi", phone:"+358 50 123 45", city:"Tampere"}
];

const inventory = [
  {sku:"A-STICK-CC60", name:"USB-C till USB-C 60W", price:149, stock:73},
  {sku:"CAR-CHG-60W", name:"Bil-laddare 60W (2-port)", price:199, stock:42},
  {sku:"LIGHT-27W", name:"USB-C till Lightning 27W", price:179, stock:172},
  {sku:"A-USB-A-C36", name:"USB-A ‚Üí USB-C 36W", price:129, stock:95}
];

const employees = [
  {id:"E-01", name:"Jesper Karlsson", role:"S√§lj", email:"jesper@mergx.se", phone:"+46 73 000 00 01", form:"Heltid"},
  {id:"E-02", name:"Lea Nguyen", role:"Lager", email:"lea@mergx.se", phone:"+46 73 000 00 02", form:"Provanst√§lld"}
];

const orders = [
  {no:"O-230015", customer:"Nordic AB", status:"Packas", terms:"30 dagar", total:"24 200,00 kr"},
  {no:"O-230016", customer:"Stock Wireless", status:"Skapad", terms:"14 dagar", total:"12 890,00 kr"},
  {no:"O-230018", customer:"Nordic AB", status:"Skapad", terms:"14 dagar", total:"14 090,00 kr"},
];

const shortOrders = [
  {no:"#10234", customer:"Acme AB", total:"24 900 kr", status:"Skapad idag"},
  {no:"#10231", customer:"Elon City", total:"12 200 kr", status:"Skapad ig√•r"}
];

/* ---------- Router ---------- */
const pages = {
  '#/dashboard':'page-dashboard',
  '#/customers':'page-customers',
  '#/inventory':'page-inventory',
  '#/orders':'page-orders',
  '#/employees':'page-employees',
  '#/files':'page-files',
  '#/chat':'page-chat',
  '#/settings':'page-settings',
};
function route(){
  const hash = location.hash || '#/dashboard';
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(pages[hash]).classList.add('active');
  document.querySelectorAll('#nav a').forEach(a=>{
    if(a.getAttribute('href')===hash) a.classList.add('active'); else a.classList.remove('active');
  });
}
window.addEventListener('hashchange', route); route();

/* ---------- Tables render ---------- */
function renderCustomers(){
  const tb = document.querySelector('#customersTable tbody'); tb.innerHTML='';
  customers.forEach(c=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${c.id}</td><td>${c.company}</td><td>${c.contact}</td>
      <td>${c.email}</td><td>${c.phone}</td><td>${c.city}</td>
      <td class="row-actions">
        <button class="btn" onclick='openCustomer("${c.id}")'>Visa</button>
        <button class="btn warn" onclick='editItem("customer","${c.id}")'>Redigera</button>
        <button class="btn danger" onclick='removeItem("customer","${c.id}")'>Ta bort</button>
      </td>`;
    tr.style.cursor="pointer";
    tr.addEventListener('click', (e)=>{ if(e.target.tagName!=='BUTTON') openCustomer(c.id) });
    tb.appendChild(tr);
  });
}
function openCustomer(id){
  const c = customers.find(x=>x.id===id);
  const el = document.getElementById('customerDetail');
  document.getElementById('customerDrawer').style.display='block';
  el.innerHTML = `
    <div><strong>${c.company}</strong></div>
    <div>Kontakt: ${c.contact}</div>
    <div>Org.nr: ‚Äî</div>
    <div>Email: ${c.email}</div>
    <div>Telefon: ${c.phone}</div>
    <div>Adress: ‚Äî, ${c.city}</div>
  `;
}
function renderInventory(){
  const tb = document.querySelector('#inventoryTable tbody'); tb.innerHTML='';
  inventory.forEach(p=>{
    const warn = p.stock<25 ? `<span class="badge" style="background:#fff7ed;color:#7a4d00">‚ö† l√•g niv√•</span>` : '';
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${p.sku}</td><td>${p.name}</td><td>${p.price} kr</td>
      <td>${p.stock} ${warn}</td>
      <td class="row-actions">
        <button class="btn warn" onclick='editItem("product","${p.sku}")'>Redigera</button>
        <button class="btn danger" onclick='removeItem("product","${p.sku}")'>Ta bort</button>
      </td>`;
    tb.appendChild(tr);
  });
}
function renderEmployees(){
  const tb = document.querySelector('#employeesTable tbody'); tb.innerHTML='';
  employees.forEach(e=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${e.id}</td><td>${e.name}</td><td>${e.role}</td><td>${e.email}</td>
      <td>${e.phone}</td><td>${e.form}</td>
      <td class="row-actions">
        <button class="btn warn" onclick='editItem("employee","${e.id}")'>Redigera</button>
        <button class="btn danger" onclick='removeItem("employee","${e.id}")'>Ta bort</button>
      </td>`;
    tb.appendChild(tr);
  });
}
function renderOrders(){
  // dashboard short
  const tb1 = document.querySelector('#ordersTable tbody'); tb1.innerHTML='';
  shortOrders.forEach(o=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${o.no}</td><td>${o.customer}</td><td>${o.total}</td><td>${o.status}</td>
    <td class="row-actions">
      <button class="btn" onclick='previewInvoice("${o.no}")' title="F√∂rhandsgranska">üëÅ</button>
      <button class="btn" onclick='downloadPdf("${o.no}")' title="Ladda ner PDF">‚§ì PDF</button>
    </td>`;
    tb1.appendChild(tr);
  });

  // orders page
  const tb2 = document.querySelector('#ordersTable2 tbody'); tb2.innerHTML='';
  orders.forEach(o=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${o.no}</td><td>${o.customer}</td><td>${o.status}</td>
    <td>${o.terms}</td><td>${o.total}</td>
    <td class="row-actions">
      <button class="btn" onclick='previewInvoice("${o.no}")'>üëÅ</button>
      <button class="btn" onclick='downloadPdf("${o.no}")'>‚§ì PDF</button>
    </td>`;
    tb2.appendChild(tr);
  });
}

/* ---------- Actions (mock) ---------- */
function editItem(type, id){ alert(`Redigera ${type}: ${id} (mock)`); }
function removeItem(type, id){
  if(confirm(`Ta bort ${type}: ${id}?`)){ alert('Borttagen (mock)'); }
}

/* ---------- Chart ---------- */
let ecoChart;
function initChart(){
  const ctx = document.getElementById('ecoChart');
  ecoChart = new Chart(ctx, {
    type:'bar',
    data:{
      labels:['v1','v2','v3','v4','v5'],
      datasets:[
        {label:'Oms√§ttning', data:[100,120,95,140,160], borderWidth:0,
         backgroundColor:'rgba(58,174,216,.55)', borderRadius:8},
        {label:'Kostnader', data:[60,70,45,65,72], borderWidth:0,
         backgroundColor:'rgba(124,209,192,.55)', borderRadius:8},
        {type:'line', label:'Brutto%', data:[35,36,37,38.5,40.2],
         borderColor:'#7aa0ff', backgroundColor:'transparent', tension:.35, pointRadius:3}
      ]
    },
    options:{
      responsive:true, maintainAspectRatio:false,
      plugins:{ legend:{ labels:{color:'#667085'} } },
      scales:{ x:{ grid:{display:false}}, y:{ ticks:{ color:'#667085'}} }
    }
  });
}

/* ---------- Map ---------- */
function initMap(){
  const map = L.map('map',{zoomControl:false}).setView([59.334, 18.063], 9);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom:18, attribution:'¬© OpenStreetMap'
  }).addTo(map);
  L.marker([59.334,18.063]).addTo(map).bindPopup('Stockholm ‚Ä¢ Din position (mock)');
}

/* ---------- Chat ---------- */
function sendChat(which=1){
  const input = which===1 ? document.getElementById('chatInput') : document.getElementById('chatInput2');
  const box   = which===1 ? document.getElementById('chatBox')   : document.getElementById('chatBox2');
  const t = input.value.trim(); if(!t) return;
  const b = document.createElement('div'); b.className='bubble me'; b.textContent=t;
  box.appendChild(b); input.value='';
  box.scrollTop = box.scrollHeight;
}
document.getElementById('chatInput')  .addEventListener('keydown', e=>{ if(e.key==='Enter') sendChat(1) })
document.getElementById('chatInput2') .addEventListener('keydown', e=>{ if(e.key==='Enter') sendChat(2) })

/* ---------- Search quick (mock) ---------- */
document.getElementById('q').addEventListener('keydown', (e)=>{
  if((e.metaKey||e.ctrlKey) && e.key.toLowerCase()==='k'){ e.preventDefault(); e.target.focus(); }
  if(e.key==='Enter'){
    alert('S√∂k (mock): '+e.target.value);
  }
});

/* ---------- Orders: preview/PDF ---------- */
function toggle(sel, on){ document.querySelector(sel).classList[on?'add':'remove']('show'); }
function previewInvoice(no='FACT-PREVIEW'){
  // enkel HTML-PDF i frame (mock)
  const html = `
    <html><head><meta charset="utf-8">
    <style>body{font-family:Inter,Arial;padding:24px} h1{font-size:20px} table{width:100%;border-collapse:collapse} td,th{border:1px solid #ddd;padding:8px}</style>
    </head><body>
      <h1>Faktura ${no}</h1>
      <p>Kund: Demo AB ‚Ä¢ Datum: ${new Date().toLocaleDateString('sv-SE')}</p>
      <table><thead><tr><th>Artikel</th><th>Antal</th><th>Pris</th></tr></thead>
        <tbody><tr><td>USB-C 60W</td><td>10</td><td>149 kr</td></tr>
        <tr><td>Lightning 27W</td><td>5</td><td>179 kr</td></tr></tbody>
      </table>
      <p style="text-align:right"><strong>Att betala: 3 035 kr</strong></p>
    </body></html>`;
  const blob = new Blob([html], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  document.getElementById('pdfFrame').src = url;
  toggle('#preview', true);
}
function downloadPdf(no='FACT-DOWNLOAD'){
  const text = `PDF (mock) f√∂r ${no} ‚Äî genererad ${new Date().toLocaleString('sv-SE')}`;
  const blob = new Blob([text],{type:'application/pdf'});
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `${no}.pdf`; a.click();
}

/* ---------- Notifications ---------- */
document.getElementById('bell').addEventListener('click', ()=>{
  const dot = document.getElementById('dot'); dot.textContent='0'; dot.style.display='none';
  alert('3 ol√§sta notiser markerade som l√§sta (mock).');
});

/* ---------- Init ---------- */
renderCustomers(); renderInventory(); renderEmployees(); renderOrders();
initChart(); initMap();

/* Accessibility: close preview ESC */
window.addEventListener('keydown', e=>{ if(e.key==='Escape') toggle('#preview', false) });
</script>
</body>
</html>
