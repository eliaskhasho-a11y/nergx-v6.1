<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MergX v8.21 ‚Äî Admin</title>

  <!-- Libs -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css">
  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    :root{
      /* Dark + glass */
      --bg:#0F1115;
      --panel:rgba(22,25,32,.72);
      --panel-strong:rgba(22,25,32,.90);
      --glass:rgba(255,255,255,.06);
      --glass-2:rgba(255,255,255,.10);
      --text:#E7ECF3;
      --muted:#94A3B8;
      --primary:#5AC8FA;    /* pastell bl√•/turkos */
      --accent:#A78BFA;     /* lila pastell till detaljer */
      --good:#4ADE80;
      --bad:#F87171;
      --radius:14px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --border:1px solid rgba(255,255,255,.08);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      background:
        radial-gradient(900px 600px at 20% -10%, #1a2240 0%, transparent 55%),
        radial-gradient(1000px 700px at 110% 20%, #13211f 0%, transparent 55%),
        var(--bg);
      font:14px/1.45 ui-sans-serif,system-ui,Segoe UI,Inter,Roboto,Helvetica,Arial;
    }

    /* Layout */
    .app{
      min-height:100dvh;
      display:grid;
      grid-template-columns:260px 1fr;
    }
    @media (max-width:980px){
      .app{grid-template-columns:1fr}
      .sidebar{position:sticky; top:0; z-index:20}
    }

    .sidebar{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border-right:var(--border);
      backdrop-filter: blur(18px);
    }
    .brand{
      display:flex;align-items:center;gap:10px;
      padding:18px 16px;border-bottom:var(--border)
    }
    .logo{
      width:28px;height:28px;border-radius:9px;
      background:linear-gradient(135deg,#2EC5FF,#5B8DEF 55%,#A78BFA);
      box-shadow:0 6px 18px rgba(90,200,250,.28);
    }
    .brand small{color:var(--muted)}

    nav{padding:12px}
    .navitem{
      display:flex;align-items:center;gap:10px;
      padding:10px 12px;border-radius:10px;
      color:var(--text); text-decoration:none;
    }
    .navitem:hover{background:var(--glass)}
    .navitem.active{background:var(--glass-2); outline:1px solid rgba(255,255,255,.08)}

    .content{
      padding:18px;
    }

    .topbar{
      display:flex;gap:12px;align-items:center;flex-wrap:wrap;
      margin-bottom:16px;
    }
    .search{
      flex:1;
      display:flex;align-items:center;gap:10px;
      background:var(--panel);border:var(--border);
      padding:10px 12px;border-radius:12px;box-shadow:var(--shadow)
    }
    .search input{
      flex:1;background:transparent;border:0;color:var(--text);outline:none;
    }
    .chip{
      padding:8px 12px;border-radius:999px;background:var(--glass);
      border:var(--border);color:var(--muted)
    }

    /* Cards / modules */
    .grid{
      display:grid;gap:14px;
      grid-template-columns:repeat(12,1fr);
    }
    .kpis .card{grid-column:span 3}
    @media (max-width:1100px){ .kpis .card{grid-column:span 6} }
    @media (max-width:700px){  .kpis .card{grid-column:span 12} }

    .card{
      background:var(--panel);
      border:var(--border);
      border-radius:16px;
      padding:16px;
      box-shadow:var(--shadow);
      position:relative;
    }
    .card h4{margin:0 0 8px 0; color:var(--muted); font-weight:600}
    .big{font-size:26px; font-weight:700; letter-spacing:.3px}
    .mini{
      height:10px;border-radius:999px;background:rgba(255,255,255,.06);overflow:hidden
    }
    .mini > span{display:block;height:100%;background:rgba(74,222,128,.2)}
    .trend{color:var(--good);font-weight:600}

    /* Module header actions */
    .actions{position:absolute; right:10px; top:10px; display:flex; gap:8px}
    .btn{
      background:var(--glass); border:var(--border); color:var(--text);
      padding:8px 12px;border-radius:10px; cursor:pointer
    }
    .btn:hover{background:var(--glass-2)}

    /* Chart wrap */
    .chartwrap{height:360px}
    .fill{height:100%;width:100%}

    /* Split columns */
    .col-span-8{grid-column:span 8}
    .col-span-4{grid-column:span 4}
    .col-span-6{grid-column:span 6}
    .col-span-12{grid-column:span 12}

    /* Chat */
    .chat-area{
      display:flex;flex-direction:column;gap:10px;min-height:220px;
    }
    .bubble{max-width:72%;padding:10px 12px;border-radius:16px; background:var(--glass)}
    .bubble.me{ margin-left:auto; background:rgba(90,200,250,.18); outline:1px solid rgba(90,200,250,.28) }
    .composer{display:flex; gap:10px; align-items:center}
    .composer .iconbtn{
      width:40px;height:40px;display:grid;place-items:center;border-radius:12px;
      background:var(--glass); border:var(--border); cursor:pointer
    }
    .composer input{
      flex:1; background:var(--panel-strong); border:var(--border);
      border-radius:12px; padding:12px; color:var(--text);
    }

    /* Table */
    table{width:100%; border-collapse:separate; border-spacing:0 8px}
    th,td{padding:10px 12px}
    th{color:var(--muted); text-align:left}
    tr{background:var(--panel-strong); border:var(--border)}
    tr td:first-child{border-radius:10px 0 0 10px}
    tr td:last-child{border-radius:0 10px 10px 0}

    /* Modal */
    .modal{
      position:fixed; inset:0; z-index:50; display:none;
      background:rgba(0,0,0,.55); backdrop-filter: blur(6px);
      align-items:center; justify-content:center; padding:20px;
    }
    .modal.show{display:flex}
    .modal .box{
      width:min(960px, 96vw); max-height:92dvh; overflow:auto;
      background:var(--panel); border:var(--border); border-radius:16px; box-shadow:var(--shadow);
    }
    .modal .head{display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:var(--border)}
    .modal .body{padding:16px}

    .muted{color:var(--muted)}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;background:var(--glass);border:var(--border);color:var(--muted)}
    .link{color:var(--primary); cursor:pointer}
  </style>
</head>
<body>
  <div class="app">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <div style="font-weight:700">MergX Admin</div>
          <small>v8.21 ¬∑ Dark + Glass</small>
        </div>
      </div>
      <nav id="nav">
        <a class="navitem active" href="#/dashboard">√ñversikt</a>
        <a class="navitem" href="#/orders">Ordrar & fakturor</a>
        <a class="navitem" href="#/customers">Kunder (CRM)</a>
        <a class="navitem" href="#/inventory">Inventarie</a>
        <a class="navitem" href="#/employees">Anst√§llda</a>
        <a class="navitem" href="#/files">Filer & kvitton</a>
        <a class="navitem" href="#/aimap">AI-karta</a>
        <a class="navitem" href="#/settings">Inst√§llningar</a>
      </nav>
    </aside>

    <!-- CONTENT -->
    <main class="content">
      <div class="topbar">
        <div class="search">
          üîé <input id="globalsearch" placeholder="S√∂k i MergX‚Ä¶ (kunder, order, produkter)" />
        </div>
        <span class="chip">üîî 3</span>
        <span class="chip"><a class="link" href="#/dashboard">G√• till √ñversikt</a></span>
      </div>

      <div id="view"><!-- routed content --></div>
    </main>
  </div>

  <!-- KPI MODAL -->
  <div id="kpiModal" class="modal">
    <div class="box">
      <div class="head">
        <div id="kpiTitle" style="font-weight:700">KPI</div>
        <div><button class="btn" onclick="closeKpi()">St√§ng</button></div>
      </div>
      <div class="body" id="kpiBody"></div>
    </div>
  </div>

  <!-- PDF PREVIEW MODAL -->
  <div id="pdfModal" class="modal">
    <div class="box">
      <div class="head">
        <div style="font-weight:700">F√∂rhandsgranska faktura</div>
        <div style="display:flex; gap:8px">
          <button id="pdfNewTab" class="btn">√ñppna i ny flik</button>
          <button class="btn" onclick="closePdf()">St√§ng</button>
        </div>
      </div>
      <div class="body">
        <iframe id="pdfFrame" style="width:100%; min-height:70dvh; border:0; background:#fff; border-radius:8px"></iframe>
      </div>
    </div>
  </div>

<script>
/* -------------------------- Simple Router -------------------------- */
const routes = {
  '/dashboard': renderDashboard,
  '/orders': renderOrders,
  '/customers': renderCustomers,
  '/inventory': renderInventory,
  '/employees': renderEmployees,
  '/files': renderFiles,
  '/aimap': renderAiMapPage,
  '/settings': renderSettings
}
function go(){
  const hash = location.hash.replace('#','') || '/dashboard';
  // highlight nav
  document.querySelectorAll('#nav .navitem').forEach(a=>{
    a.classList.toggle('active', a.getAttribute('href').replace('#','')===hash);
  });
  (routes[hash] || routes['/dashboard'])();
}
window.addEventListener('hashchange', go);
window.addEventListener('load', go);

/* -------------------------- Utilities -------------------------- */
function el(html){ const t = document.createElement('template'); t.innerHTML=html.trim(); return t.content.firstElementChild }
function pct(v){ return Math.max(0,Math.min(100, v||0)) }

/* -------------------------- Dashboard -------------------------- */
let ecoChart;

function renderDashboard(){
  const root = document.getElementById('view');
  root.innerHTML = `
  <section class="grid kpis">
    ${kpiCard('Oms√§ttning (idag)','124 500 kr',6.2,'/kpi/revenue')}
    ${kpiCard('Order idag','37',4,'/kpi/orders')}
    ${kpiCard('Kostnader (idag)','48 900 kr',-2.1,'/kpi/costs')}
    ${kpiCard('Bruttomarginal','41.5%',+0.7,'/kpi/gm')}
  </section>

  <section class="grid" style="margin-top:14px">
    <div class="card col-span-8">
      <div class="actions">
        <button class="btn" onclick="aiExplain('eco')">Ask AI</button>
        <button class="btn" onclick="expandModule(this)">Expandera</button>
      </div>
      <h3 style="margin:0 0 8px 0">Ekonomi ‚Äî kombostaplar</h3>
      <div class="chartwrap"><canvas id="ecoChart"></canvas></div>
    </div>

    <div class="card col-span-4">
      <div class="actions">
        <button class="btn" onclick="aiExplain('map')">Ask AI</button>
        <button class="btn" onclick="expandModule(this)">Expandera</button>
      </div>
      <h3 style="margin:0 0 8px 0">AI-karta (mini)</h3>
      <div id="miniMap" style="height:230px;border-radius:10px; overflow:hidden"></div>
      <div class="pill" style="margin-top:10px">AI-rekommendationer (mock)</div>
      <div class="muted" style="margin-top:6px">Bes√∂k <b>Elon Kista</b> ‚Üí <b>Power Solna</b> ‚Üí <b>Mekonomen Bromma</b>. Total ca 43 min.</div>
    </div>

    <div class="card col-span-8">
      <div class="actions">
        <button class="btn" onclick="aiExplain('chat')">Ask AI</button>
        <button class="btn" onclick="expandModule(this)">Expandera</button>
      </div>
      <h3 style="margin:0 0 8px 0">Teamchatt</h3>
      <div id="chat" class="chat-area">
        <div class="bubble">God morgon teamet!</div>
        <div class="bubble me">Jag tar kundm√∂tet 11:00.</div>
      </div>
      <div class="composer" style="margin-top:8px">
        <div class="iconbtn" title="Bifoga fil">üìé</div>
        <div class="iconbtn" title="Spela in r√∂st" onclick="recordVoice()">üéôÔ∏è</div>
        <input id="chatInput" placeholder="Skriv ett meddelande‚Ä¶ (Enter f√∂r att skicka)" />
        <button class="btn" onclick="sendMsg()">Skicka</button>
      </div>
    </div>

    <div class="card col-span-4" id="ordersMini"></div>
  </section>
  `;
  // KPI click -> modal
  root.querySelectorAll('[data-kpi]').forEach(card=>{
    card.addEventListener('click',()=> openKpi(card.dataset.kpi, card.dataset.value, card.dataset.trend));
  });

  // chart
  const ctx = document.getElementById('ecoChart');
  if (ecoChart) ecoChart.destroy();
  ecoChart = new Chart(ctx, {
    type:'bar',
    data:{
      labels:['v1','v2','v3','v4','v5'],
      datasets:[
        {label:'Oms√§ttning', data:[100,120,80,140,160], backgroundColor:'rgba(90,200,250,.35)', borderRadius:6},
        {label:'Kostnader', data:[60,60,45,55,70], backgroundColor:'rgba(167,139,250,.30)', borderRadius:6},
        {label:'Brutto%', type:'line', data:[58,60,57,59,62], borderColor:'#5AC8FA', borderWidth:2, pointBackgroundColor:'#5AC8FA', tension:.35, yAxisID:'y1'}
      ]
    },
    options:{
      maintainAspectRatio:false,
      plugins:{legend:{labels:{color:'#C7D2FE'}}},
      scales:{
        x:{ticks:{color:'#A3B2C7'}, grid:{color:'rgba(255,255,255,.06)'}},
        y:{ticks:{color:'#A3B2C7'}, grid:{color:'rgba(255,255,255,.06)'}},
        y1:{position:'right', ticks:{color:'#A3B2C7'}, grid:{drawOnChartArea:false}}
      }
    }
  });

  // mini map mock
  const map = L.map('miniMap',{zoomControl:false, attributionControl:false}).setView([59.334,18.063], 11);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  L.marker([59.403,17.95]).addTo(map);

  // Orders mini table
  const orders = [
    {nr:'#10234', kund:'Acme AB', total:'24 900 kr', status:'Skapad idag'},
    {nr:'#10231', kund:'Elon City', total:'12 200 kr', status:'Skapad ig√•r'},
  ];
  document.getElementById('ordersMini').innerHTML = renderOrdersCard(orders);
}

function kpiCard(title,value,trend,slug){
  const good = trend>=0;
  return `
  <div class="card" data-kpi="${slug}" data-value="${value}" data-trend="${trend}">
    <h4>${title}</h4>
    <div class="big">${value}</div>
    <div class="mini" style="margin-top:8px"><span style="width:${pct(Math.abs(trend))*3}%; background:${good?'rgba(74,222,128,.28)':'rgba(248,113,113,.28)'}"></span></div>
    <div class="trend" style="margin-top:6px;color:${good?'var(--good)':'var(--bad)'}">${good?'+':''}${trend}${typeof trend==='number' ? (Math.abs(trend)<5?'':'') : ''}%</div>
  </div>`;
}

function openKpi(slug, value, trend){
  // simple table + ai text for demo
  const title = {
    '/kpi/revenue':'Oms√§ttning (idag)',
    '/kpi/orders':'Order idag',
    '/kpi/costs':'Kostnader (idag)',
    '/kpi/gm':'Bruttomarginal'
  }[slug] || 'KPI';

  document.getElementById('kpiTitle').textContent = title;
  const tbl = `
    <table>
      <thead><tr><th>Period</th><th>V√§rde</th><th>F√∂r√§ndring</th></tr></thead>
      <tbody>
        <tr><td>Idag</td><td>${value}</td><td>${trend>=0?'+':''}${trend}%</td></tr>
        <tr><td>7 dagar</td><td>${fakeDelta(value,1.12)}</td><td>+8.1%</td></tr>
        <tr><td>30 dagar</td><td>${fakeDelta(value,9.84)}</td><td>+12.7%</td></tr>
      </tbody>
    </table>
    <div class="muted" style="margin-top:12px">
      <b>AI-analys:</b> Tillv√§xten drivs av B2B-order och s√§songseffekt. Rek: √∂ka annonsering mot
      segment ‚Äúbutikskedjor‚Äù, samt f√∂lj upp lagersaldon f√∂r USB-C 60W (l√•g niv√•).
    </div>
  `;
  document.getElementById('kpiBody').innerHTML = tbl;
  document.getElementById('kpiModal').classList.add('show');
}
function closeKpi(){ document.getElementById('kpiModal').classList.remove('show') }

function fakeDelta(v, mult){ return v.replace(/\d/g,'').trim()? v : v; } // placeholder

function aiExplain(scope){
  alert('AI-analys ('+scope+'): mock i denna bygg ‚Äì kopplas till Ollama/DeepSeek i n√§sta version.');
}

function expandModule(btn){
  const card = btn.closest('.card');
  // Create overlay modal and clone node
  const modal = el(`<div class="modal show"><div class="box"><div class="head"><div style="font-weight:700">Expanderad modul</div><div><button class="btn closeX">St√§ng</button></div></div><div class="body"></div></div></div>`);
  modal.querySelector('.closeX').onclick = ()=> modal.remove();
  modal.addEventListener('click', e=>{ if(e.target===modal) modal.remove(); });
  modal.querySelector('.body').append(card.cloneNode(true));
  document.body.append(modal);
}

/* -------------------------- Orders page -------------------------- */
function renderOrders(){
  const root = document.getElementById('view');
  const rows = [
    {nr:'O-230015', kund:'Nordic AB', total:'24 200,00 kr', villkor:'30 dagar'},
    {nr:'O-230016', kund:'Stock Wireless', total:'12 890,00 kr', villkor:'14 dagar'},
    {nr:'O-230018', kund:'Nordic AB', total:'14 089,00 kr', villkor:'14 dagar'},
  ];
  root.innerHTML = `
    <section class="card">
      <div class="actions"><button class="btn" onclick="alert('Skapa order (mock)')">Skapa order</button></div>
      <h3 style="margin:0 0 12px 0">Order & faktura</h3>
      <table>
        <thead><tr><th>Ordernr</th><th>Kund</th><th>Total</th><th>Betalvillkor</th><th>√Ötg√§rder</th></tr></thead>
        <tbody>
          ${rows.map(r=>`
            <tr>
              <td>${r.nr}</td>
              <td>${r.kund}</td>
              <td>${r.total}</td>
              <td>${r.villkor}</td>
              <td>
                <button class="btn" onclick="previewPdf('${r.nr}')">üëÅ F√∂rhandsgranska</button>
                <button class="btn" onclick="downloadPdf('${r.nr}')">‚¨áÔ∏é PDF</button>
              </td>
            </tr>
          `).join('')}
        </tbody>
      </table>
      <div class="muted" style="margin-top:8px">PDF-export (jsPDF) kopplas i n√§sta sprint ‚Äî nu visas mock-PDF i modal. ‚Äú√ñppna i ny flik‚Äù finns i dialogen.</div>
    </section>
  `;
}
function renderOrdersCard(list){
  return `
  <h3 style="margin:0 0 8px 0">Ordrar & fakturor</h3>
  <table>
    <thead><tr><th>Nr</th><th>Kund</th><th>Total</th><th>Status</th><th>PDF</th></tr></thead>
    <tbody>
      ${list.map(x=>`
        <tr>
          <td>${x.nr}</td>
          <td>${x.kund}</td>
          <td>${x.total}</td>
          <td>${x.status}</td>
          <td>
            <button class="btn" onclick="previewPdf('${x.nr}')">üëÅ</button>
            <button class="btn" onclick="downloadPdf('${x.nr}')">‚¨áÔ∏é</button>
          </td>
        </tr>
      `).join('')}
    </tbody>
  </table>`;
}

function pdfDataUrl(orderNr){
  // Enkel, giltig PDF som data-url (mock)
  const pdf = `%PDF-1.4
1 0 obj<<>>endobj
2 0 obj<< /Type /Page /Parent 3 0 R /Resources<<>> /MediaBox[0 0 595 842] /Contents 4 0 R>>endobj
3 0 obj<< /Type /Pages /Kids[2 0 R] /Count 1 >>endobj
4 0 obj<< /Length 77 >>stream
BT /F1 18 Tf 50 770 Td (MergX Faktura ${orderNr}) Tj 0 -30 Td (Detta \$begin:math:text$mock\\$end:math:text$ ar en PDF-preview.) Tj ET
endstream endobj
5 0 obj<< /Type /Catalog /Pages 3 0 R >>endobj
xref 0 6
0000000000 65535 f 
0000000010 00000 n 
0000000053 00000 n 
0000000164 00000 n 
0000000242 00000 n 
0000000391 00000 n 
trailer<< /Root 5 0 R /Size 6>>
startxref
470
%%EOF`;
  return 'data:application/pdf;base64,'+btoa(pdf);
}
function previewPdf(orderNr){
  const url = pdfDataUrl(orderNr);
  const frame = document.getElementById('pdfFrame');
  frame.src = url;
  const openNew = document.getElementById('pdfNewTab');
  openNew.onclick = ()=> window.open(url,'_blank');
  document.getElementById('pdfModal').classList.add('show');
}
function closePdf(){ document.getElementById('pdfModal').classList.remove('show') }
function downloadPdf(orderNr){
  const a = document.createElement('a');
  a.href = pdfDataUrl(orderNr);
  a.download = `Faktura_${orderNr}.pdf`;
  a.click();
}

/* -------------------------- Other pages -------------------------- */
function renderCustomers(){
  document.getElementById('view').innerHTML = `
    <section class="card">
      <div class="actions"><button class="btn" onclick="alert('L√§gg till kund (mock)')">L√§gg till kund</button></div>
      <h3 style="margin:0 0 10px 0">Kunder / CRM</h3>
      <table>
        <thead><tr><th>F√∂retag</th><th>Org.nr</th><th>Kontakt</th><th>E-post</th><th>√Ötg√§rd</th></tr></thead>
        <tbody>
          <tr><td>Acme AB</td><td>556677-8899</td><td>Lisa</td><td>lisa@acme.se</td><td><span class="link">Visa</span></td></tr>
          <tr><td>Nordic Phone</td><td>559900-1122</td><td>Johan</td><td>johan@nordic.se</td><td><span class="link">Visa</span></td></tr>
          <tr><td>Elon City</td><td>556100-4433</td><td>Karin</td><td>karin@eloncity.se</td><td><span class="link">Visa</span></td></tr>
        </tbody>
      </table>
      <div class="muted" style="margin-top:8px">Klicka ‚ÄúVisa‚Äù f√∂r kundkort (mock) ‚Äî i kommande version kopplas √§ven r√∂stlogg och AI-sammanfattning per kund.</div>
    </section>
  `;
}

function renderInventory(){
  document.getElementById('view').innerHTML = `
    <section class="card">
      <div class="actions"><button class="btn" onclick="alert('L√§gg till produkt (mock)')">L√§gg till produkt</button></div>
      <h3 style="margin:0 0 10px 0">Inventarie</h3>
      <table>
        <thead><tr><th>SKU</th><th>Namn</th><th>Pris</th><th>Saldo</th><th>Status</th><th>√Ötg√§rd</th></tr></thead>
        <tbody>
          <tr><td>A-STICK-CC60</td><td>USB-C till USB-C 60W</td><td>149</td><td>73</td><td><span class="pill">OK</span></td><td><span class="link">Redigera</span></td></tr>
          <tr><td>CAR-CHG-60W</td><td>Bil-laddare (2-port)</td><td>199</td><td>42</td><td><span class="pill" style="background:rgba(250,204,21,.2)">L√•g niv√•</span></td><td><span class="link">Redigera</span></td></tr>
          <tr><td>LIGHT-27W</td><td>USB-C till Lightning 27W</td><td>179</td><td>128</td><td><span class="pill">OK</span></td><td><span class="link">Redigera</span></td></tr>
        </tbody>
      </table>
    </section>
  `;
}

function renderEmployees(){
  document.getElementById('view').innerHTML = `
    <section class="card">
      <div class="actions"><button class="btn" onclick="alert('L√§gg till anst√§lld (mock)')">L√§gg till anst√§lld</button></div>
      <h3 style="margin:0 0 10px 0">Anst√§llda</h3>
      <table>
        <thead><tr><th>ID</th><th>Namn</th><th>Roll</th><th>E-post</th><th>Telefon</th><th>Form</th></tr></thead>
        <tbody>
          <tr><td>E-01</td><td>Jesper Karlsson</td><td>S√§lj</td><td>jesper@mergx.se</td><td>+46 73 000 00 01</td><td>Heltid</td></tr>
          <tr><td>E-02</td><td>Lea Nguyen</td><td>Lager</td><td>lea@mergx.se</td><td>+46 73 000 00 02</td><td>Provanst√§lld</td></tr>
        </tbody>
      </table>
    </section>
  `;
}

function renderFiles(){
  document.getElementById('view').innerHTML = `
    <section class="card">
      <h3 style="margin:0 0 10px 0">Filer & kvitton</h3>
      <div class="muted">Kommande: mappar, uppladdning, taggar, noteringar och arbetsfl√∂de till Ekonomi/Admin.</div>
      <div style="margin-top:10px"><button class="btn" onclick="alert('Ladda upp (mock)')">Ladda upp</button></div>
    </section>
  `;
}

function renderAiMapPage(){
  document.getElementById('view').innerHTML = `
    <section class="card">
      <div class="actions"><button class="btn" onclick="aiExplain('aimap')">Ask AI</button></div>
      <h3 style="margin:0 0 10px 0">AI-karta</h3>
      <div id="bigMap" style="height:60dvh;border-radius:12px;overflow:hidden"></div>
      <div class="muted" style="margin-top:10px">GPS kopplas i kommande (navigator.geolocation) + Google Places/Directions. Just nu mock med Stockholm-yta.</div>
    </section>
  `;
  const map = L.map('bigMap').setView([59.334,18.063], 10);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
  L.marker([59.403,17.95]).addTo(map).bindPopup('Elon Kista (mock)');
}

function renderSettings(){
  document.getElementById('view').innerHTML = `
    <section class="card">
      <h3 style="margin:0 0 10px 0">Inst√§llningar</h3>
      <div class="muted">F√∂retagsuppgifter (f√∂r faktura), fraktintegration (Fraktjakt), finansbolag/fakturering och AI-nycklar l√§ggs h√§r i n√§sta version.</div>
      <div style="margin-top:12px; display:grid; gap:10px; max-width:560px">
        <input placeholder="F√∂retagsnamn" class="input"/>
        <input placeholder="Org.nr" class="input"/>
        <input placeholder="Adress" class="input"/>
        <input placeholder="E-post f√∂r fakturor" class="input"/>
        <button class="btn" onclick="alert('Sparat (mock)')">Spara</button>
      </div>
    </section>
  `;
}

/* -------------------------- Chat mock -------------------------- */
function sendMsg(){
  const i = document.getElementById('chatInput');
  const v = (i.value||'').trim();
  if(!v) return;
  const b = el(`<div class="bubble me"></div>`); b.textContent=v;
  document.getElementById('chat').append(b);
  i.value='';
}
async function recordVoice(){
  if(!navigator.mediaDevices?.getUserMedia){
    alert('Mikrofon st√∂ds inte i denna webbl√§sare (mock).'); return;
  }
  const stream = await navigator.mediaDevices.getUserMedia({audio:true});
  const rec = new MediaRecorder(stream);
  const chunks=[];
  rec.ondataavailable = e=> chunks.push(e.data);
  rec.onstop = ()=>{
    const blob = new Blob(chunks,{type:'audio/webm'});
    const url = URL.createObjectURL(blob);
    const b = el(`<div class="bubble me"></div>`);
    b.innerHTML = `üé§ R√∂stmeddelande (mock) ‚Äî <a class="link" href="${url}" target="_blank">spela upp</a>`;
    document.getElementById('chat').append(b);
  };
  rec.start();
  setTimeout(()=> rec.stop(), 2000); // 2s demo
}

/* -------------------------- Kickers -------------------------- */
document.addEventListener('keydown', e=>{
  if(e.key==='Enter' && document.activeElement?.id==='chatInput'){
    e.preventDefault(); sendMsg();
  }
});
</script>
</body>
</html>
