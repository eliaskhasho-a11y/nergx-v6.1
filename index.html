<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MergX v8.19 ‚Äì Admin</title>

  <!-- Leaflet (karta) -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" />
  <script defer src="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Chart.js (grafer) -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <style>
    :root{
      --bg:#f6f8fb;
      --card:#ffffff;
      --text:#101828;
      --muted:#667085;
      --primary:#2563eb;   /* bl√• pastell */
      --accent:#22c55e;    /* gr√∂n */
      --danger:#ef4444;
      --shadow: 0 10px 32px rgba(16,24,40,.06), 0 4px 10px rgba(16,24,40,.04);
      --radius:16px;
      --gap:16px;
      --glass-stroke:#e9edf5;
    }

    /* EN (1) body ‚Äì all layout startar h√§r */
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 20% -10%, #e9f0ff 0%, transparent 60%),
        var(--bg);
      font:15px/1.5 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Helvetica, Arial;
      -webkit-font-smoothing:antialiased;
      overflow-x:hidden;
    }

    .app{
      display:grid;
      grid-template-columns: 260px 1fr;
      min-height:100dvh;
    }

    /* Sidebar */
    .sidebar{
      position:sticky; top:0; align-self:start;
      background:rgba(255,255,255,.65);
      backdrop-filter: blur(12px);
      border-right:1px solid var(--glass-stroke);
      padding:20px 12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px; margin-bottom:16px;
      font-weight:700;
    }
    .brand .x{
      width:28px; height:28px; border-radius:8px;
      background:linear-gradient(135deg,#1d4ed8,#22d3ee); display:inline-block;
    }
    .nav{
      display:flex; flex-direction:column; gap:8px;
    }
    .nav a{
      text-decoration:none; color:var(--text);
      padding:10px 12px; border-radius:10px; display:flex; gap:10px; align-items:center;
    }
    .nav a.active, .nav a:hover{
      background:rgba(37,99,235,.08);
    }

    /* Topbar */
    .topbar{
      position:sticky; top:0; z-index:10;
      display:flex; gap:12px; align-items:center;
      padding:12px;
      background:rgba(255,255,255,.7);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--glass-stroke);
    }
    .search{
      flex:1; position:relative;
    }
    .search input{
      width:100%; border:1px solid var(--glass-stroke);
      background:rgba(255,255,255,.8);
      padding:12px 14px; border-radius:12px;
      outline:none;
    }
    .to-oversikt{ padding:10px 12px; border-radius:10px; border:1px solid var(--glass-stroke); background:var(--card)}

    /* Containers & kort */
    .main{ padding:18px; }
    .grid{ display:grid; gap:16px }
    .grid.cols-2{ grid-template-columns: 2fr 1fr }
    .grid.cols-3{ grid-template-columns: repeat(3,1fr) }
    .grid.cols-4{ grid-template-columns: repeat(4,1fr) }

    .card{
      background:rgba(255,255,255,.9);
      backdrop-filter: blur(12px);
      border:1px solid var(--glass-stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
    }
    .card h3{ margin:0 0 10px 0; font-size:16px }

    .kpi{
      display:flex; flex-direction:column; gap:8px;
      min-height:110px;
    }
    .kpi .value{ font-size:28px; font-weight:800 }
    .kpi .trend{ display:block; height:28px; border-radius:14px; background:#ecfdf5; color:#16a34a; font-weight:700; display:flex; align-items:center; padding:0 12px; width:30%}

    /* Tabeller */
    table{ width:100%; border-collapse:collapse; }
    th,td{ text-align:left; padding:10px 8px; border-bottom:1px solid #eef2f7 }
    th{ color:var(--muted); font-weight:600 }

    /* actions */
    .btn{ border:1px solid var(--glass-stroke); background:var(--card); padding:8px 10px; border-radius:10px; cursor:pointer }
    .btn.primary{ background:var(--primary); color:#fff; border-color:transparent }
    .btn.danger{ background:var(--danger); color:#fff; border-color:transparent }
    .btn.ghost{ background:transparent }

    /* expand-sheet (icke blockerande modal) */
    .sheet{
      position:fixed; inset:auto 0 0 0; translate:0 100%;
      transition:translate .25s ease; z-index:20;
      background:rgba(255,255,255,.95); backdrop-filter:blur(10px);
      border-top:1px solid var(--glass-stroke);
      padding:16px 18px; max-height:60dvh; overflow:auto;
      box-shadow:0 -12px 30px rgba(16,24,40,.08)
    }
    .sheet.open{ translate:0 0 }
    .sheet h4{ margin:0 0 8px 0 }

    /* chatt-widget */
    .chat{
      position:fixed; right:16px; bottom:16px; width:360px; max-width:90dvw;
      background:var(--card); border:1px solid var(--glass-stroke); border-radius:12px; box-shadow:var(--shadow); overflow:hidden;
    }
    .chat header{ padding:10px 12px; font-weight:700; background:rgba(37,99,235,.08) }
    .chat .messages{ height:240px; overflow:auto; padding:12px; display:flex; flex-direction:column; gap:8px}
    .bubble{ padding:8px 10px; border-radius:10px; max-width:80%}
    .me{ background:#e0f2fe; align-self:flex-end }
    .other{ background:#eef2ff }
    .chat .inputbar{ display:flex; gap:8px; padding:10px; border-top:1px solid var(--glass-stroke) }
    .chat input{ flex:1; padding:10px 12px; border-radius:10px; border:1px solid var(--glass-stroke) }

    /* responsivt */
    @media (max-width: 1100px){
      .grid.cols-4{ grid-template-columns: repeat(2,1fr) }
      .grid.cols-3{ grid-template-columns: repeat(2,1fr) }
      .grid.cols-2{ grid-template-columns: 1fr }
      .app{ grid-template-columns: 220px 1fr }
    }
    @media (max-width: 860px){
      .app{ grid-template-columns: 1fr }
      .sidebar{ position:static; border-right:0; border-bottom:1px solid var(--glass-stroke) }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- SIDOPANEL -->
    <aside class="sidebar">
      <div class="brand"><span class="x"></span> MergX Admin <small style="color:var(--muted)">v8.19</small></div>
      <nav class="nav" id="nav">
        <a href="#/oversikt">√ñversikt</a>
        <a href="#/ordrar">Ordrar & fakturor</a>
        <a href="#/kunder">Kunder (CRM)</a>
        <a href="#/inventarie">Inventarie</a>
        <a href="#/anstallda">Anst√§llda</a>
        <a href="#/filer">Filer & kvitton</a>
        <a href="#/karta">AI-karta</a>
        <a href="#/chatt">Chatt</a>
        <a href="#/installningar">Inst√§llningar</a>
      </nav>
    </aside>

    <!-- H√ñGERKOL -->
    <section>
      <!-- TOP -->
      <div class="topbar">
        <div class="search">
          <input id="globalSearch" placeholder="S√∂k i MergX‚Ä¶ (kunder, ordrar, produkter)">
        </div>
        <button class="to-oversikt btn" onclick="route('#/oversikt')">G√• till √ñversikt</button>
      </div>

      <!-- INNEH√ÖLL -->
      <main class="main" id="view"></main>
    </section>
  </div>

  <!-- EXPANDER (sheet) -->
  <div class="sheet" id="sheet">
    <h4 id="sheetTitle">Detaljer</h4>
    <div id="sheetBody"></div>
  </div>

  <!-- CHAT -->
  <div class="chat" id="chatBox">
    <header>MergX Chatt & AI</header>
    <div class="messages" id="chatMessages">
      <div class="bubble other">Hej! Jag bevakar KPI:er, lager och notiser. Fr√•ga mig vad som helst.</div>
    </div>
    <div class="inputbar">
      <input id="chatInput" placeholder="Skriv meddelande‚Ä¶ (Enter f√∂r att skicka)">
      <button class="btn primary" onclick="sendChat()">Skicka</button>
    </div>
  </div>

<script>
/* ------------------ Mock-data ------------------ */
const state = {
  kpi:{ revenueToday:124500, ordersToday:37, costsToday:48900, gm:41.5, revTrend:'+6.2%', ordTrend:'+4', costTrend:'-2.1%', gmTrend:'+0.7 pp'},
  orders:[
    {nr:'O-230015', kund:'Nordic AB', summa:'24 200,00 kr', status:'Packas', betal:'30 dagar'},
    {nr:'O-230016', kund:'Stock Wireless', summa:'12 890,00 kr', status:'Skapad', betal:'14 dagar'},
    {nr:'O-230018', kund:'Nordic AB', summa:'10 049,00 kr', status:'Skapad', betal:'14 dagar'}
  ],
  customers:[
    {id:'C1001', company:'Nordic AB', contact:'Eva Berg', email:'eva@nordic.se', tel:'+46 70 123 45 67', stad:'Stockholm'},
    {id:'C1002', company:'Stock Wireless', contact:'Jonas Ek', email:'sales@stockwireless.se', tel:'+46 73 555 66 77', stad:'Stockholm'},
    {id:'C1003', company:'Elon Ljud & Bild', contact:'Butikschef', email:'info@elonlb.se', tel:'+46 8 111 22 33', stad:'V√§ster√•s'},
  ],
  inventory:[
    {sku:'A-STICK-CC60', name:'USB-C till USB-C 60W', pris:149, saldo:73},
    {sku:'CAR-CHG-60W', name:'Bil-laddare 60W (2-port)', pris:199, saldo:42},
    {sku:'LIGHT-27W', name:'USB-C till Lightning 27W', pris:179, saldo:172},
  ],
  employees:[
    {id:'E-01', namn:'Jesper Karlsson', roll:'S√§lj', form:'Heltid', email:'jesper@mergx.se', tel:'+46 73 000 00 01'},
    {id:'E-02', namn:'Lea Nguyen', roll:'Lager', form:'Provanst√§lld', email:'lea@mergx.se', tel:'+46 73 000 00 02'},
  ],
  files:[]
};

/* -------------- Sm√• verktyg -------------- */
const $ = sel => document.querySelector(sel);
function route(hash){ location.hash = hash; }
function setActiveNav(){
  document.querySelectorAll('#nav a').forEach(a=>{
    a.classList.toggle('active', a.getAttribute('href')===location.hash);
  });
}

/* -------------- Vy-renderare -------------- */
function viewOversikt(){
  const v = document.getElementById('view');
  v.innerHTML = `
    <div class="grid cols-4">
      ${kpiCard('Oms√§ttning idag', state.kpi.revenueToday.toLocaleString('sv-SE')+' kr', state.kpi.revTrend)}
      ${kpiCard('Order idag', state.kpi.ordersToday.toLocaleString('sv-SE'), state.kpi.ordTrend)}
      ${kpiCard('Kostnader (idag)', state.kpi.costsToday.toLocaleString('sv-SE')+' kr', state.kpi.costTrend, true)}
      ${kpiCard('Bruttomarginal', state.kpi.gm+'%', state.kpi.gmTrend)}
    </div>

    <div class="grid cols-2" style="margin-top:16px">
      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <h3>Ekonomi ‚Äî kombostaplar</h3>
          <button class="btn" onclick="openSheet('Ekonomi ‚Äî AI-analys', econAI())">Expandera</button>
        </div>
        <canvas id="econChart" height="120"></canvas>
      </div>

      <div class="card">
        <h3>AI-karta (mini)</h3>
        <div id="map" style="height:260px;border-radius:12px;border:1px solid var(--glass-stroke)"></div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <button class="btn" onclick="openSheet('AI-rekommendationer', routeAI())">AI-rekommendationer</button>
          <button class="btn" onclick="addVisitNote()">L√§gg notis</button>
        </div>
      </div>
    </div>

    <div class="grid cols-2" style="margin-top:16px">
      <div class="card">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <h3>Teamchatt</h3>
          <button class="btn" onclick="openSheet('Teamchatt', teamHistory())">Expandera</button>
        </div>
        <div class="bubble other">God morgon teamet!</div>
        <div class="bubble me">Jag tar kundm√∂tet 11:00.</div>
        <div style="display:flex;gap:8px;margin-top:10px">
          <input id="dashChat" placeholder="Skriv och tryck Enter‚Ä¶" style="flex:1;padding:10px;border:1px solid var(--glass-stroke);border-radius:10px" />
          <button class="btn" onclick="sendDashChat()">Skicka</button>
        </div>
      </div>

      <div class="card">
        <h3>Ordrar & fakturor</h3>
        <table>
          <thead><tr><th>Nr</th><th>Kund</th><th>Total</th><th>Status</th><th>√Ötg√§rder</th></tr></thead>
          <tbody>
            ${state.orders.map(o=>`
              <tr>
                <td>${o.nr}</td><td>${o.kund}</td><td>${o.summa}</td><td>${o.status}</td>
                <td>
                  <button class="btn" onclick="openSheet('F√∂rhandsgranska', previewInvoice('${o.nr}','${o.kund}','${o.summa}'))">üëÅ</button>
                  <button class="btn" onclick="downloadPDF('${o.nr}')">‚¨áÔ∏é PDF</button>
                </td>
              </tr>`).join('')}
          </tbody>
        </table>
      </div>
    </div>
  `;
  initChart(); initMap(); // init efter DOM
}

function viewTable(rows, title, cols, actions=()=>{}) {
  return `
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3>${title}</h3>
        <div style="display:flex;gap:8px">
          <button class="btn" onclick="${actions.create ?? 'alert(`Skapa (mock)`)'}">Skapa</button>
          <button class="btn" onclick="openSheet('${title} ‚Äî snabbfilter', '<small>Kommer i v8.20</small>')">Filter</button>
        </div>
      </div>
      <table>
        <thead><tr>${cols.map(c=>`<th>${c}</th>`).join('')}<th>√Ötg</th></tr></thead>
        <tbody>${rows}</tbody>
      </table>
    </div>
  `;
}

function viewKunder(){
  const rows = state.customers.map(c=>`
    <tr>
      <td>${c.id}</td><td>${c.company}</td><td>${c.contact}</td><td>${c.email}</td><td>${c.tel}</td><td>${c.stad}</td>
      <td>
        <button class="btn" onclick="openSheet('Kundkort ‚Äî ${c.company}', customerCard('${c.id}'))">√ñppna</button>
        <button class="btn" onclick="alert('Redigera (mock)')">Redigera</button>
        <button class="btn danger" onclick="alert('Ta bort (mock)')">Ta bort</button>
      </td>
    </tr>`).join('');
  $('#view').innerHTML = viewTable(rows,'Kunder (CRM)',['ID','F√∂retag','Kontakt','E-post','Telefon','Stad']);
}

function viewInventarie(){
  const rows = state.inventory.map(p=>`
    <tr>
      <td>${p.sku}</td><td>${p.name}</td><td>${p.pris} kr</td><td>${p.saldo}</td>
      <td>
        <button class="btn" onclick="alert('Redigera (mock)')">Redigera</button>
        <button class="btn danger" onclick="alert('Ta bort (mock)')">Ta bort</button>
      </td>
    </tr>`).join('');
  $('#view').innerHTML = viewTable(rows,'Inventarie',['SKU','Namn','Pris','Lagersaldo']);
}

function viewOrdrar(){
  const rows = state.orders.map(o=>`
    <tr>
      <td>${o.nr}</td><td>${o.kund}</td><td>${o.summa}</td><td>${o.betal}</td>
      <td>
        <button class="btn" onclick="openSheet('Order ${o.nr}', previewInvoice('${o.nr}','${o.kund}','${o.summa}'))">Visa</button>
        <button class="btn" onclick="downloadPDF('${o.nr}')">‚¨áÔ∏é PDF</button>
      </td>
    </tr>`).join('');
  $('#view').innerHTML = viewTable(rows,'Ordrar & fakturor',['Nr','Kund','Total','Betalvillkor'],{create:"alert('Skapa order (mock)')"});
}

function viewAnstallda(){
  const rows = state.employees.map(e=>`
    <tr>
      <td>${e.id}</td><td>${e.namn}</td><td>${e.roll}</td><td>${e.email}</td><td>${e.tel}</td><td>${e.form}</td>
      <td>
        <button class="btn" onclick="alert('Redigera (mock)')">Redigera</button>
        <button class="btn danger" onclick="alert('Ta bort (mock)')">Ta bort</button>
      </td>
    </tr>`).join('');
  $('#view').innerHTML = viewTable(rows,'Anst√§llda',['ID','Namn','Roll','E-post','Telefon','Anst.form'],{create:"alert('L√§gg till anst√§lld (mock)')"});
}

function viewFiler(){
  $('#view').innerHTML = `
    <div class="card">
      <h3>Filer & kvitton</h3>
      <p><small>Kommande: mappar, drag-and-drop, taggar, export till Ekonomi/Admin.</small></p>
      <input type="file" multiple>
    </div>`;
}

function viewKarta(){
  $('#view').innerHTML = `
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h3>AI-karta</h3>
        <button class="btn" onclick="openSheet('AI-karta ‚Äî rekommendationer', routeAI())">Ask AI</button>
      </div>
      <div id="map2" style="height:420px;border-radius:12px;border:1px solid var(--glass-stroke)"></div>
      <div style="margin-top:10px;display:flex;gap:8px">
        <button class="btn" onclick="addVisitNote()">L√§gg notis</button>
        <button class="btn" onclick="openSheet('Bes√∂ksnotiser', '<ul><li>Elon Kista: k√∂p om 20 dagar</li></ul>')">Visa notiser</button>
      </div>
    </div>`;
  initMap('#map2', true);
}

function viewChatt(){
  $('#view').innerHTML = `
    <div class="card">
      <h3>Teamchatt</h3>
      <div class="bubble other">V√§lkommen tillbaka!</div>
      <div class="bubble me">Redo f√∂r dagens rundor.</div>
      <div style="display:flex;gap:8px;margin-top:10px">
        <input id="pageChat" placeholder="Skriv och tryck Enter‚Ä¶" style="flex:1;padding:10px;border:1px solid var(--glass-stroke);border-radius:10px" />
        <button class="btn" onclick="sendPageChat()">Skicka</button>
      </div>
    </div>`;
}

function viewInst(){
  $('#view').innerHTML = `
    <div class="card">
      <h3>Inst√§llningar</h3>
      <p>F√∂retagsuppgifter (f√∂r faktura), fraktkoppling (Fraktjakt), finansbolag, SMTP/SMS-gateway ‚Äì planerat mellan 8.20‚Äì8.22.</p>
      <p><small>V√§lj g√§rna vilka integrationer du vill b√∂rja med f√∂rst.</small></p>
    </div>`;
}

/* -------------- Router -------------- */
function render(){
  setActiveNav();
  switch(location.hash){
    case '#/kunder': return viewKunder();
    case '#/inventarie': return viewInventarie();
    case '#/ordrar': return viewOrdrar();
    case '#/anstallda': return viewAnstallda();
    case '#/filer': return viewFiler();
    case '#/karta': return viewKarta();
    case '#/chatt': return viewChatt();
    case '#/installningar': return viewInst();
    default: return viewOversikt();
  }
}
window.addEventListener('hashchange', render);

/* -------------- Komponenter -------------- */
function kpiCard(title,val,trend,isCost){
  const c = isCost ? '#eef6ff' : '#ecfdf5';
  const tcol = isCost ? '#2563eb':'#16a34a';
  return `
  <div class="card kpi">
    <div style="color:var(--muted)">${title}</div>
    <div class="value">${val}</div>
    <div class="trend" style="background:${c}; color:${tcol}">${trend}</div>
  </div>`;
}

function openSheet(title, bodyHTML){
  $('#sheetTitle').textContent = title;
  $('#sheetBody').innerHTML = bodyHTML;
  $('#sheet').classList.add('open');
}
document.addEventListener('keydown', e=>{ if(e.key==='Escape') $('#sheet').classList.remove('open'); });

/* -------------- Ekonomi-graf -------------- */
let econChart;
function initChart(){
  const ctx = document.getElementById('econChart');
  if(!ctx) return;
  econChart && econChart.destroy();
  econChart = new Chart(ctx, {
    type:'bar',
    data:{
      labels:['v1','v2','v3','v4','v5'],
      datasets:[
        {label:'Oms√§ttning', data:[100,125,90,140,160], backgroundColor:'rgba(37,99,235,.25)'},
        {label:'Kostnader', data:[60,70,45,65,75], backgroundColor:'rgba(34,197,94,.20)'},
        {label:'Brutto%', data:[40,40,41,40,42], type:'line', yAxisID:'y1', borderColor:'#6366f1', backgroundColor:'#6366f1'}
      ]
    },
    options:{
      responsive:true,
      scales:{ y:{beginAtZero:true}, y1:{position:'right', min:0, max:100} },
      plugins:{ legend:{labels:{color:'#6b7280'}}}
    }
  });
}
function econAI(){
  return `
    <p><strong>AI-analys (mock)</strong></p>
    <ul>
      <li>Oms√§ttning +6.2% vs ig√•r; bruttomarginal stabil p√• 41‚Äì42%.</li>
      <li>Rekommendation: h√∂j pris p√• l√•g-marginalartiklar 2‚Äì3% och planera ink√∂p f√∂r LIGHT-27W.</li>
      <li>F√∂rslag: erbjud cross-sell ‚ÄúBil-laddare 60W‚Äù p√• order √∂ver 500 kr.</li>
    </ul>`;
}

/* -------------- Karta -------------- */
let mapInstance;
function initMap(sel='#map', zoomedMini=false){
  const el = document.querySelector(sel);
  if(!el) return;
  mapInstance = L.map(el).setView([59.334591, 18.063240], zoomedMini?11:12);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{ maxZoom:19 }).addTo(mapInstance);
  const pin = L.marker([59.334591,18.063240]).addTo(mapInstance);
  pin.bindPopup('Din position (mock)');
}
function routeAI(){
  return `
    <p><strong>AI-rutt (mock):</strong> Elon Kista ‚Üí Power Solna ‚Üí Mekonomen Bromma. Total ca 43 min.</p>
    <p><em>Kommer kopplas till Google Places + Directions i v8.19‚Üív8.20.</em></p>`;
}
function addVisitNote(){
  openSheet('Ny notis', `
    <label>Plats/Butik</label><br>
    <input style="width:100%;padding:10px;border:1px solid var(--glass-stroke);border-radius:10px" placeholder="Elon Kista"><br><br>
    <label>Notis</label><br>
    <input style="width:100%;padding:10px;border:1px solid var(--glass-stroke);border-radius:10px" placeholder="Vill k√∂pa produkter om 20 dagar"><br><br>
    <button class="btn primary" onclick="alert('Sparad (mock)');$('#sheet').classList.remove('open')">Spara</button>
  `);
}

/* -------------- Chatt -------------- */
function sendChat(){
  const i = $('#chatInput'); const v=i.value.trim(); if(!v) return;
  $('#chatMessages').insertAdjacentHTML('beforeend', `<div class="bubble me">${v}</div>`);
  i.value=''; setTimeout(()=>$('#chatMessages').insertAdjacentHTML('beforeend', `<div class="bubble other">Noterat ‚úÖ</div>`), 500);
}
function sendPageChat(){
  const i = $('#pageChat'); const v=i.value.trim(); if(!v) return;
  i.value=''; alert('Skickat (mock)');
}
function sendDashChat(){
  const i = $('#dashChat'); const v=i.value.trim(); if(!v) return;
  i.value=''; alert('Meddelande skickat (mock)');
}
$('#chatInput').addEventListener('keydown', e=>{ if(e.key==='Enter') sendChat(); });

/* -------------- Orders (preview/PDF) -------------- */
function previewInvoice(nr,kund,summa){
  return `
  <p><strong>Order:</strong> ${nr}</p>
  <p><strong>Kund:</strong> ${kund}</p>
  <p><strong>Summa:</strong> ${summa}</p>
  <p><small>PDF-generator kopplas i v8.20 (jsPDF/Server).</small></p>`;
}
function downloadPDF(nr){ alert('Laddar ner PDF (mock) f√∂r '+nr); }

/* -------------- Kundkort -------------- */
function customerCard(id){
  const c = state.customers.find(x=>x.id===id);
  if(!c) return 'Saknas';
  return `
    <p><strong>${c.company}</strong></p>
    <p>Kontakt: ${c.contact}</p>
    <p>E-post: ${c.email} ‚Äî Tel: ${c.tel}</p>
    <p>Stad: ${c.stad}</p>
    <div style="display:flex;gap:8px">
      <button class="btn" onclick="alert('Skapa order (mock)')">Skapa order</button>
      <button class="btn" onclick="alert('Skicka SMS/WhatsApp (mock)')">Skicka meddelande</button>
    </div>`;
}

/* -------------- S√∂k (inte blockera klick) -------------- */
$('#globalSearch').addEventListener('focus', ()=>{/* reserv, men input ligger i topbar med h√∂g z-index */});

/* Init */
if(!location.hash) location.hash = '#/oversikt';
render();
</script>
</body>
</html>
