<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MergX v8.33 ‚Äî Glass Intelligence Core</title>
  <meta name="theme-color" content="#0e1116" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/styles.css">
</head>

<body class="theme-dark">
  <!-- ========== App Shell ========== -->
  <div id="app">

    <!-- ===== Sidebar / Nav ===== -->
    <aside class="sidebar glass">
      <div class="brand">
        <div class="brand__name">MergX</div>
        <div class="brand__tag">v8.33 ‚Ä¢ CORE</div>
      </div>

      <nav class="nav">
        <button class="nav__link is-active" data-route="dashboard">√ñversikt</button>
        <button class="nav__link" data-route="customers">Kunder (CRM)</button>
        <button class="nav__link" data-route="inventory">Inventarie</button>
        <button class="nav__link" data-route="orders">Order & fakturor</button>
        <button class="nav__link" data-route="employees">Anst√§llda</button>
        <button class="nav__link" data-route="files">Filer & kvitton</button>
        <button class="nav__link" data-route="ai-map">AI-karta</button>
        <button class="nav__link" data-route="chat">Chatt & AI</button>
        <button class="nav__link" data-route="settings">Inst√§llningar</button>
      </nav>

      <div class="sidebar__bottom">
        <div class="select-row">
          <label for="langSelect">Spr√•k</label>
          <select id="langSelect">
            <option value="sv" selected>Svenska</option>
            <option value="en">English</option>
          </select>
        </div>
        <div class="select-row">
          <label for="themeSelect">Tema</label>
          <select id="themeSelect">
            <option value="dark" selected>M√∂rk</option>
            <option value="light">Ljust</option>
            <option value="auto">Auto</option>
          </select>
        </div>
      </div>
    </aside>

    <!-- ===== Main ===== -->
    <main class="main">

      <!-- Topbar -->
      <header class="topbar">
        <div class="search glass">
          <input id="globalSearch" type="search" placeholder="S√∂k i MergX‚Ä¶ (kunder, order, produkter)">
          <button class="icon-btn" id="globalSearchBtn" aria-label="S√∂k">
            üîç
          </button>
        </div>
        <div class="topbar__actions">
          <button id="askAiGlobal" class="btn btn-primary">Ask AI</button>
          <button id="userBadge" class="chip">EK</button>
        </div>
      </header>

      <!-- ========== DASHBOARD ========== -->
      <section id="view-dashboard" class="view is-visible">
        <!-- KPI Row -->
        <div class="row">
          <div class="card kpi" data-kpi="revenue">
            <header class="card__header">
              <h3>Oms√§ttning (idag)</h3>
              <div class="card__tools">
                <button class="chip ghost" data-action="expand-kpi">Expandera</button>
              </div>
            </header>
            <div class="kpi__value" id="kpiRevenue">‚Äî</div>
            <div class="kpi__trend" id="kpiRevenueTrend">‚Äî</div>
            <div class="kpi__bar"><span style="width:0%" id="kpiRevenueBar"></span></div>
          </div>

          <div class="card kpi" data-kpi="orders">
            <header class="card__header">
              <h3>Order idag</h3>
              <div class="card__tools">
                <button class="chip ghost" data-action="expand-kpi">Expandera</button>
              </div>
            </header>
            <div class="kpi__value" id="kpiOrders">‚Äî</div>
            <div class="kpi__trend" id="kpiOrdersTrend">‚Äî</div>
            <div class="kpi__bar"><span style="width:0%" id="kpiOrdersBar"></span></div>
          </div>

          <div class="card kpi" data-kpi="costs">
            <header class="card__header">
              <h3>Kostnader (idag)</h3>
              <div class="card__tools">
                <button class="chip ghost" data-action="expand-kpi">Expandera</button>
              </div>
            </header>
            <div class="kpi__value" id="kpiCosts">‚Äî</div>
            <div class="kpi__trend" id="kpiCostsTrend">‚Äî</div>
            <div class="kpi__bar"><span style="width:0%" id="kpiCostsBar"></span></div>
          </div>

          <div class="card kpi" data-kpi="margin">
            <header class="card__header">
              <h3>Bruttomarginal</h3>
              <div class="card__tools">
                <button class="chip ghost" data-action="expand-kpi">Expandera</button>
              </div>
            </header>
            <div class="kpi__value" id="kpiMargin">‚Äî</div>
            <div class="kpi__trend" id="kpiMarginTrend">‚Äî</div>
            <div class="kpi__bar"><span style="width:0%" id="kpiMarginBar"></span></div>
          </div>
        </div>

        <!-- Graph + AI Coach -->
        <div class="row">
          <div class="card" style="flex:2">
            <header class="card__header">
              <h3>Ekonomi ‚Äî kombostaplar</h3>
              <div class="card__tools">
                <button class="chip ghost" id="graphAskAi">Ask AI</button>
                <button class="chip ghost" id="graphExpand">Expandera</button>
              </div>
            </header>
            <div class="card__body">
              <!-- Chart canvas (renderas i JS) -->
              <canvas id="comboChart" height="140"></canvas>
              <p class="muted tiny">Staplar: Oms√§ttning/Kostnader  ‚Ä¢  Linje: Bruttomarginal</p>
            </div>
          </div>

          <div class="card" style="flex:1">
            <header class="card__header">
              <h3>AI-coach</h3>
              <div class="card__tools">
                <button class="chip ghost" id="coachClear">Rensa</button>
              </div>
            </header>
            <div class="card__body ai-coach">
              <div class="messages" id="coachMessages">
                <div class="msg bot">Hej! Jag √§r din MergX-coach. Vad vill du g√∂ra idag?</div>
              </div>
              <div class="composer">
                <button class="icon-btn" id="coachAttach" title="Bifoga">üìé</button>
                <button class="icon-btn" id="coachMic" title="Spela in">üé§</button>
                <input id="coachInput" class="input" placeholder="Skriv ett meddelande‚Ä¶ (Enter f√∂r att skicka)">
                <button id="coachSend" class="btn btn-primary">Skicka</button>
              </div>
            </div>
          </div>
        </div>

        <!-- AI Map -->
        <div class="row">
          <div class="card">
            <header class="card__header">
              <h3>AI-karta (mini)</h3>
              <div class="card__tools">
                <button class="chip ghost" id="mapAskAi">AI-rekommendationer</button>
              </div>
            </header>
            <div class="card__body">
              <div id="mapMini" class="map-placeholder">
                <div class="map-empty">Karta (mock i denna version)</div>
                <ul class="map-notes tiny">
                  <li><b>Elon Kista</b> ‚Äî Potentiell order om 20 dagar</li>
                  <li><b>Mekonomen Solna</b> ‚Äî Befintlig kund</li>
                  <li><b>Power Barkarby</b> ‚Äî Bra l√§ge f√∂r demo</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ========== CUSTOMERS ========== -->
      <section id="view-customers" class="view">
        <div class="toolbar">
          <h2>Kunder / CRM</h2>
          <div class="tools">
            <input class="input input--small" id="customerSearch" placeholder="S√∂k kund‚Ä¶">
            <button class="btn" id="btnAddCustomer">+ Ny kund</button>
          </div>
        </div>
        <div class="card">
          <div class="table-scroll">
            <table class="table" id="tblCustomers">
              <thead>
                <tr>
                  <th>F√∂retag</th>
                  <th>Org.nr</th>
                  <th>Kontakt</th>
                  <th>E-post</th>
                  <th>Adress</th>
                  <th class="right">√Ötg√§rd</th>
                </tr>
              </thead>
              <tbody><!-- dynamiskt --></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ========== INVENTORY ========== -->
      <section id="view-inventory" class="view">
        <div class="toolbar">
          <h2>Inventarie</h2>
          <div class="tools">
            <button class="btn" id="btnAddProduct">+ L√§gg till produkt</button>
          </div>
        </div>
        <div class="card">
          <div class="table-scroll">
            <table class="table" id="tblInventory">
              <thead>
                <tr>
                  <th>SKU</th>
                  <th>Namn</th>
                  <th>Pris</th>
                  <th>Saldo</th>
                  <th>Status</th>
                  <th class="right">√Ötg√§rd</th>
                </tr>
              </thead>
              <tbody><!-- dynamiskt --></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ========== ORDERS (stub for now) ========== -->
      <section id="view-orders" class="view">
        <div class="toolbar">
          <h2>Order & fakturor</h2>
          <div class="tools">
            <button class="btn" id="btnCreateOrder">+ Skapa order</button>
          </div>
        </div>
        <div class="card">
          <div class="empty">Orderlistan kommer i n√§sta sprint (kopplad till PDF/kvittomodul).</div>
        </div>
      </section>

      <!-- ========== EMPLOYEES ========== -->
      <section id="view-employees" class="view">
        <div class="toolbar">
          <h2>Anst√§llda</h2>
          <div class="tools">
            <button class="btn" id="btnAddEmployee">+ L√§gg till anst√§lld</button>
          </div>
        </div>
        <div class="card">
          <div class="table-scroll">
            <table class="table" id="tblEmployees">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Namn</th>
                  <th>Roll</th>
                  <th>E-post</th>
                  <th>Telefon</th>
                  <th>Form</th>
                  <th class="right">√Ötg√§rd</th>
                </tr>
              </thead>
              <tbody><!-- dynamiskt --></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- ========== FILES & RECEIPTS ========== -->
      <section id="view-files" class="view">
        <div class="toolbar">
          <h2>Filer & kvitton</h2>
          <div class="tools">
            <button class="btn" id="btnUpload">Ladda upp</button>
          </div>
        </div>
        <div class="card">
          <div class="file-grid" id="fileGrid">
            <!-- dynamiska kort (bilder/kvitton/mappar) -->
          </div>
          <p class="muted tiny">Kommande: mappar, taggar, arbetsfl√∂de & OCR-l√§sning kopplat till ekonomi/anst√§lld.</p>
        </div>
      </section>

      <!-- ========== AI MAP ========== -->
      <section id="view-ai-map" class="view">
        <div class="toolbar">
          <h2>AI-karta</h2>
          <div class="tools">
            <button class="btn" id="btnRoute">Skapa rutt</button>
            <button class="btn" id="btnMapSuggest">AI-f√∂rslag</button>
          </div>
        </div>
        <div class="card">
          <div class="map-placeholder map-full"><div class="map-empty">Karta (mock)</div></div>
          <div class="notes">
            <div class="note"><b>Notiser:</b> ‚ÄúElon Kista vill k√∂pa produkter om 20 dagar.‚Äù</div>
          </div>
        </div>
      </section>

      <!-- ========== CHAT & AI (separat vy) ========== -->
      <section id="view-chat" class="view">
        <div class="toolbar">
          <h2>Chatt & AI</h2>
          <div class="tools">
            <div class="segmented">
              <button class="seg is-active" data-chatmode="ai">AI-coach</button>
              <button class="seg" data-chatmode="team">Teamchatt</button>
            </div>
          </div>
        </div>

        <div class="row">
          <!-- Shared chat container -->
          <div class="card" style="flex:1">
            <header class="card__header"><h3 id="chatHeaderTitle">AI-coach</h3></header>
            <div class="card__body chat">
              <div class="messages" id="chatMessages">
                <div class="msg bot">Jag bevakar KPI:er, lager och notiser. Fr√•ga mig vad som helst.</div>
              </div>
              <div class="composer">
                <button class="icon-btn" id="chatAttach">üìé</button>
                <button class="icon-btn" id="chatMic">üé§</button>
                <input id="chatInput" class="input" placeholder="Skriv meddelande‚Ä¶ (Enter skickar)">
                <button id="chatSend" class="btn btn-primary">Skicka</button>
              </div>
            </div>
          </div>

          <!-- Side info -->
          <div class="card" style="flex:1">
            <header class="card__header"><h3>AI-sammanfattning</h3></header>
            <div class="card__body">
              <ul id="aiSummary" class="list">
                <!-- AI summerar l√∂pande h√§r -->
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- ========== SETTINGS ========== -->
      <section id="view-settings" class="view">
        <div class="toolbar"><h2>Inst√§llningar</h2></div>
        <div class="card">
          <form id="settingsForm" class="form-grid">
            <fieldset>
              <legend>F√∂retagsuppgifter</legend>
              <label>F√∂retagsnamn
                <input class="input" id="setCompany" placeholder="Ditt AB">
              </label>
              <label>Adress
                <input class="input" id="setAddress" placeholder="Gata 1, Stad">
              </label>
              <label>Org.nr
                <input class="input" id="setOrgNr" placeholder="556xxx-xxxx">
              </label>
              <label>E-post ekonomi
                <input class="input" id="setEconomyEmail" placeholder="economy@company.se">
              </label>
            </fieldset>

            <fieldset>
              <legend>Integrationer (placeholders)</legend>
              <label>Fraktjakt API-nyckel
                <input class="input" id="setFraktjaktKey" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
              </label>
              <label>Finansbolag API-nyckel
                <input class="input" id="setFinanceKey" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
              </label>
              <label>WhatsApp/SMS gateway
                <input class="input" id="setSmsGateway" placeholder="+46‚Ä¶">
              </label>
              <label>AI-nyckel (valfri)
                <input class="input" id="setAiKey" placeholder="sk-‚Ä¶ (mock)">
              </label>
            </fieldset>

            <fieldset>
              <legend>App</legend>
              <label>Tema
                <select id="setTheme" class="input">
                  <option value="dark" selected>M√∂rk</option>
                  <option value="light">Ljust</option>
                  <option value="auto">Auto</option>
                </select>
              </label>
              <label>Spr√•k
                <select id="setLang" class="input">
                  <option value="sv" selected>Svenska</option>
                  <option value="en">English</option>
                </select>
              </label>
            </fieldset>

            <div class="form-actions">
              <button type="submit" class="btn btn-primary">Spara</button>
            </div>
          </form>
        </div>
      </section>

      <!-- FOOTER -->
      <footer class="footer tiny muted">
        ¬© MergX ‚Ä¢ Powered by AI (mock i denna core)
      </footer>
    </main>
  </div>

  <!-- ========== MODALS ========== -->

  <!-- KPI Detail Modal -->
  <div class="modal" id="modalKpi">
    <div class="modal__dialog glass-strong">
      <button class="modal__close" data-close="modalKpi">‚úï</button>
      <header class="modal__header"><h3 id="modalKpiTitle">KPI ‚Äî Detaljer</h3></header>
      <div class="modal__body">
        <canvas id="kpiDetailChart" height="140"></canvas>
        <table class="table compact">
          <thead><tr><th>Period</th><th>V√§rde</th></tr></thead>
          <tbody id="kpiDetailRows"><!-- dynamiskt --></tbody>
        </table>
        <div class="ai-hint" id="kpiDetailAi">AI-analys: ‚Äî</div>
      </div>
    </div>
  </div>

  <!-- Add/Edit Customer -->
  <div class="modal" id="modalCustomer">
    <div class="modal__dialog glass-strong">
      <button class="modal__close" data-close="modalCustomer">‚úï</button>
      <header class="modal__header"><h3 id="modalCustomerTitle">Ny kund</h3></header>
      <div class="modal__body">
        <form id="formCustomer" class="grid-2">
          <label>F√∂retag
            <input class="input" name="company" required>
          </label>
          <label>Org.nr
            <input class="input" name="orgnr" required>
          </label>
          <label>Kontakt
            <input class="input" name="contact" required>
          </label>
          <label>E-post
            <input class="input" type="email" name="email" required>
          </label>
          <label class="grid-2-col">Adress
            <input class="input" name="address" placeholder="Gata, Postnr, Stad">
          </label>
        </form>
      </div>
      <footer class="modal__footer">
        <button class="btn" data-close="modalCustomer">Avbryt</button>
        <button class="btn btn-primary" id="saveCustomer">Spara</button>
      </footer>
    </div>
  </div>

  <!-- Add/Edit Employee -->
  <div class="modal" id="modalEmployee">
    <div class="modal__dialog glass-strong">
      <button class="modal__close" data-close="modalEmployee">‚úï</button>
      <header class="modal__header"><h3 id="modalEmployeeTitle">Ny anst√§lld</h3></header>
      <div class="modal__body">
        <form id="formEmployee" class="grid-2">
          <label>Namn
            <input class="input" name="name" required>
          </label>
          <label>Roll
            <input class="input" name="role" required>
          </label>
          <label>E-post
            <input class="input" type="email" name="email" required>
          </label>
          <label>Telefon
            <input class="input" name="phone" required>
          </label>
          <label>Form
            <select class="input" name="form">
              <option>Heltid</option>
              <option>Deltid</option>
              <option>Provanst√§lld</option>
            </select>
          </label>
        </form>
      </div>
      <footer class="modal__footer">
        <button class="btn" data-close="modalEmployee">Avbryt</button>
        <button class="btn btn-primary" id="saveEmployee">Spara</button>
      </footer>
    </div>
  </div>

  <!-- Add/Edit Product -->
  <div class="modal" id="modalProduct">
    <div class="modal__dialog glass-strong">
      <button class="modal__close" data-close="modalProduct">‚úï</button>
      <header class="modal__header"><h3 id="modalProductTitle">Ny produkt</h3></header>
      <div class="modal__body">
        <form id="formProduct" class="grid-3">
          <label>SKU
            <input class="input" name="sku" required>
          </label>
          <label>Namn
            <input class="input" name="name" required>
          </label>
          <label>Pris
            <input class="input" name="price" required>
          </label>
          <label>Saldo
            <input class="input" name="stock" required>
          </label>
        </form>
      </div>
      <footer class="modal__footer">
        <button class="btn" data-close="modalProduct">Avbryt</button>
        <button class="btn btn-primary" id="saveProduct">Spara</button>
      </footer>
    </div>
  </div>

  <!-- Upload Modal -->
  <div class="modal" id="modalUpload">
    <div class="modal__dialog glass-strong">
      <button class="modal__close" data-close="modalUpload">‚úï</button>
      <header class="modal__header"><h3>Ladda upp fil</h3></header>
      <div class="modal__body">
        <div class="upload">
          <input id="fileInput" type="file" hidden multiple />
          <div class="dropzone" id="dropzone">
            Sl√§pp filer h√§r eller <button type="button" id="pickFiles" class="link">v√§lj filer</button>
          </div>
          <div id="uploadList" class="tiny muted"></div>
        </div>
      </div>
      <footer class="modal__footer">
        <button class="btn" data-close="modalUpload">St√§ng</button>
        <button class="btn btn-primary" id="confirmUpload">Ladda upp</button>
      </footer>
    </div>
  </div>

  <!-- Overlay click-guard -->
  <div id="overlay" class="overlay"></div>

  <!-- Scripts -->
  <script src="/js/app.js" defer></script>
</body>
</html>
